# AWS

## Cloud Computing

### 클라우드 컴퓨팅의 등장 배경

기존 서버의 방식은 서버실과 같은 곳에 컴퓨터를 배치했다. 그런데 컴퓨팅 능력이 더 필요하다면? 만약 서버가 요청에 대한 수용 능력이 한계에 도달한다면? 같은 공간에 더 많은 컴퓨터를 추가하하거나 혹은 컴퓨터 한 대의 성능을 높이는 방식이 있다.

하지만 이는 주기적인 유지 관리 필요, 공간의 한계 등 많은 문제가 있다. 이런 상황에서 추가 서버 증설이 어렵게 되자 일부 거대 기업은 데이터센터라는 거대한 건물을 세우기 시작했다.
이때부터 데이터센터의 유휴 자원을 대여하는 서비스가 등장하기 시작했다.

즉 서버의 자원과 공간, 및 네트워크 환경을 제공을 빌려 사용하는 클라우드 컴퓨팅이 시작된 순간이다.

### 클라우드의 등장

> 온프레미스 : 데이터 센터에서 서버의 자원과 공간, 및 네트워크 환경을 제공하는 환경

클라우드 컴퓨팅은 데이터 센터와 비슷한 역할을 하지만 가상화 기술의 발전으로 가능한, 물리적인 컴퓨터가 아닌, 가상 컴퓨터를 대여한다는 점이 다르다.

- 장점

  1. 서버의 자원과 공간, 및 네트워크 환경 제공
     필요할 때마다 컴퓨팅 능력을 유연하게 조절할 수 있다.

  2. 고정적인 비용이 들어가는 온프레미스와는 달리 사용한 만큼의 요금만 지불

  3. 컴퓨터의 스냅샷(이미지)을 이용해 다른 컴퓨터로 즉시 이주(migration)가 가능

- 단점
  - 운영 환경 자체가 클라우드 제공자에게 종속되어 버리므로, 클라우드 서비스에 문제가 생기면 내가 배포하고 관리하는 환경에도 영향이 미친다.
  - 즉 배포 환경에 문제가 생기면 서비스에 영향을 미친다.

이런 클라우드는 모든 것을 서비스화하는 것을 목표로 한다.

### 대표적인 클라우드 서비스

- SaaS(Software as a Service) ex: Google Drive

  - 클라우드 제공자가 당장 사용 가능한 소프트웨어를 제공하는 경우

- PaaS(Platform as a Service) ex: GitHub

  - 클라우드 제공자가 데이터베이스, 개발 플랫폼까지 제공하는 경우

- IaaS(Infrastructure as a Service) ex: AWS
  - 클라우드 제공자가 가상 컴퓨터까지 제공하는 경우

## Deploy

지금까지는 로컬환경에서 코드를 작성했다. 내가 작성한 코드가 그저 로컬환경에서 구동된다면 다른 사람들은 내가 개발한 서비스를 이용할 수 없을 것이다.

사용자가 서비스를 이용할 수 있게 하는 배포에 대해서 알아보자.

### 배포

`개발한 서비스를 사용자들이 이용가능하게 하는 과정`
기본적으로 4단계를 거쳐서 개발한 서비스를 배포하게 된다.

1. Development 단계
   각자의 컴퓨터에서 코드를 작성하고 테스트 하는 과정
   개발단계이기 때문에 실제 데이터를 이용하지 않고 더미데이터를 이용해서 테스트한다.

2. Intergration 단계
   각자의 컴퓨터에서 작성한 코드를 합치는 과정
   내가 작성한 코드가 다른 코드를 침범해서 오류를 일으키지 않는지, 코드간에 conflict가 있지는 않는지 확인하는 과정

3. Staging 단계
   실제 출시단계인 Production단계와 가장 유사한 환경에서 테스트를 진행
   실제 데이터를 복사해서 문제가 있지 않은지 등 다양한 환경에서 테스트를 진행한다.
   또한 서비스와 관련된 부서 혹은 인원의 확인 과정을 거친다. 예를 들면 작성된 코드가 마케팅팀 혹은 디자인팀 예상했던 결과인지에 확인을 거치는 과정이다.

4. Production 단계
   개발된 서비스를 출시하는 단계
   사용자가 접속할 수 있는 Production 환경에서 코드를 구동하고 서비스를 제공한다.
   실제 데이터를 가지고 서비스가 운영되기 때문에 문제가 생기면 안된다.

#### 여러 명이 함께 작업하는 프로젝트라면?

node 버전도 제각각일 거고, 인증 정보나 데이터베이스 등에 접근하기 위해 사용하는 엔드포인트도 제각각일 것이다.

예를 들어, 내 로컬에 설치된 데이터베이스 비밀번호는 rlazheld1234! 인데, 클라우드에 설치된 데이터베이스 비밀번호는 supersecret! 일 수 있을 것이다.
이 모든 케이스를 코드 안에 담을 수 있을까? 아니다. 이처럼 Development 환경과 Production 환경은 서로 다를 수가 있다.

> 따라서 배포에서는, 환경의 차이를 이해하고 환경 설정을 코드와 분리하는 것이 중요하다.

#### 작성한 코드가 다른 환경에서 정상 작동할 수 있게 하려면?

- 절대경로 대신 상대경로를 사용한다.
- 환경에 따라 포트를 분기할 수 있도록 환경변수를 설정해준다.
  - 설정을 환경 변수 (envvars나 env라고도 불림)에 저장해야 한다.
- (Advanced) Docker와 같은 개발 환경 자체를 통일시키는 솔루션을 사용한다.

## EC2 서비스

아마존 웹 서비스에서 제공하는 클라우드 컴퓨팅 서비스로, AWS에서 원격으로 제어할 수 있는 가상의 컴퓨터를 한 대 빌리는 것이다.

- Elastic = 탄력(신축성)있는, 유연한
  - 사용한 만큼 비용을 지불, 필요에 따라 성능, 용량을 자유롭게 조절할 수 있다

EC2서비스는 AWS에서 비용, 성능, 용량면에서 탄력적인 클라우드 컴퓨터를 제공하는 서비스라고 할 수 있다.

또한, AMI를 통해서 필요한 용도에 따라 다양한 운영체제(Linux, ubuntu, ...)에 대한 선택이 가능하다. 운영체제 뿐만 아니라 CPU와 RAM, 용량까지도 손쉽게 구성할 수 있다.

### 인스턴스

아마존 EC2를 통해서 할 수 있는 가장 기본적인 일은 웹서버를 설치하고 웹 서버를 통해서 사용자가 웹 브라우저를 통해 요청하는 서비스를 제공하는 것이 가장 기본적인 사용방법이다.

인스턴스는 한 대의 컴퓨터를 의미하는 단위이고 AWS에서 컴퓨터를 빌리는 것을 인스턴스를 생성한다고 한다.

> AWS EC2 인스턴스를 생성한다는 것은 선택한 AMI를 토대로 운영체제, CPU, RAM 혹은 런타임 등이 구성된 컴퓨터를 빌리는 것이다.

### AMI (Amazon Machine Image)

소프트웨어 구성이 기재된 템플릿이다.
AW에서 빌릴 PC는 사용용도에 맞게 운영체제, 런타임 등이 구성된 Setting을 선택할 수 있다.

이미지 종류로는 단순히 운영체제(윈도우, 우분투 리눅스 등)만 깔려있는 템플릿을 선택할 수도 있고, 아예 특정 런타임이 설치되어있는 템플릿이 제공되는 경우도 있다. (우분투 + node.js, 윈도우 + JVM 등)

## RDS (Relational Database Service)

`AWS에서 제공하는 관계형 데이터 베이스 서비스`
ORACLE, MySQL, PostgreSQL 등 다양한 엔진 선택지를 제공한다.

#### RDS를 왜 쓸까?

EC2 인스턴스에 MySQL 같은 관계형 데이터베이스 엔진을 설치하면 굳이 RDS를 사용할 이유가 없지 않을까? 데이터베이스만 따로 분리해서 서비스를 이용해야 할 이유가 있을까?

- EC2 인스턴스를 사용하면
  - 사용자가 일일이 시간을 투자하여 데이터베이스 엔진의 설치와 버전 관리, 데이터 백업을 해야 한다.
  - 가용성과 내구성이 확보되지 않기에 데이터베이스에 저장된 데이터가 유실되거나 정상적으로 사용하지 못할 확률이 커지며, 후에 필요에 따라 데이터베이스의 규모를 확장하기 어렵다.

* RDS를 이용하면
  - 데이터베이스 유지보수와 관련된 일들을 RDS에서 전적으로 자동 관리한다.
  - 사용자가 해야할 일은 초기 설정을 제외하고 데이터베이스에 저장된 데이터를 관리하는 일 밖에 없기에 큰 편의성을 느낄 수 있다.

## Deploy Strategy (배포 전략)

처음 배포된 서비스는 도메인 주소를 통해 접근할 수 있을까?
S3, EC2를 이용해서 배포된 서비스는 IP주소 혹은 AWS에서 제공하는 서비스와는 전혀 상관없는 긴 도메인주소를 통해 접근하게 된다.

`www.todolist.ap-northeast-2.compute.amazonaws.com` 주소보다는 `www.todolist.com` 주소일 때, 직관적으로 서비스를 이해할 수 있고 짧은 주소를 통해 서비스에 접근할 수 있다.

RDS 서비스를 이용하여 EC2를 통해 배포된 Server Application의 데이터를 저장, 제공하는 데이터베이스를 배포할 수 있다. AWS에서 제공하는 Route 53 서비스를 이용하면
직관적인 도메인 주소를 통해서 서비스에 접근하도록 할 수 있다.
